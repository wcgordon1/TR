---
import BaseLayout from "./BaseLayout.astro";
import ApplicationModal from "../components/jobs/ApplicationModal.astro";
const { frontmatter } = Astro.props;

// Create JSON-LD schema
const jobSchema = {
  "@context": "https://schema.org/",
  "@type": "JobPosting",
  "title": frontmatter.position,
  "description": frontmatter.description,
  "identifier": {
    "@type": "PropertyValue",
    ...frontmatter.identifier
  },
  "datePosted": frontmatter.datePosted,
  "validThrough": frontmatter.validThrough,
  "employmentType": frontmatter.employmentType,
  "hiringOrganization": {
    "@type": "Organization",
    ...frontmatter.hiringOrganization
  },
  "jobLocation": {
    "@type": "Place",
    "address": {
      "@type": "PostalAddress",
      ...frontmatter.jobLocation
    }
  },
  "baseSalary": {
    "@type": "MonetaryAmount",
    "currency": frontmatter.baseSalary.currency,
    "value": {
      "@type": "QuantitativeValue",
      "minValue": frontmatter.baseSalary.minValue,
      "maxValue": frontmatter.baseSalary.maxValue,
      "value": frontmatter.baseSalary.value,
      "unitText": frontmatter.baseSalary.unitText
    }
  },
  "experienceRequirements": frontmatter.experienceRequirements,
  "occupationalCategory": frontmatter.occupationalCategory
};
---

<BaseLayout>
  <script type="application/ld+json" set:html={JSON.stringify(jobSchema)} />
  
  <section>
    <div
      class="mx-auto max-w-7xl lg:px-16 md:px-12 px-8 xl:px-24 lg:flex py-24">
      <div class="lg:w-1/2 lg:pl-12 lg:ml-auto">
        <div class="lg:sticker lg:sticky pb-16 pt-8 top-0">
          <div class="lg:pl-36 md:pl-12">
            <nav
              aria-label="Sidebar"
              class="bg-slate-50 rounded-lg divide-y space-y-3 p-4 lg:p-8">
              <div>
                <h3 class="text-xl font-medium text-purple-900 pt-2">
                  {frontmatter.position}
                </h3>
              </div>
              <div>
                <h3 class="text-lg font-medium text-purple-900 pt-2">
                  {frontmatter.hiringOrganization.name}
                </h3>
                <a 
                  href={frontmatter.hiringOrganization.sameAs}
                  target="_blank"
                  rel="noopener noreferrer" 
                  class="text-blue-500 hover:text-blue-600 text-sm mt-1 inline-flex items-center gap-1"
                >
                  Visit company website
                  <svg xmlns="http://www.w3.org/2000/svg" class="size-4" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none">
                    <path d="M12 6h-6a2 2 0 0 0 -2 2v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-6" />
                    <path d="M11 13l9 -9" />
                    <path d="M15 4h5v5" />
                  </svg>
                </a>
              </div>

            

              <div>
                <h3 class="text-lg font-medium text-purple-900 pt-2">
                  Posted
                </h3>
                <p class="text-slate-500 mt-1">
                  {new Date(frontmatter.datePosted).toLocaleDateString('en-US', {
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric'
                  })}
                </p>
              </div>

              <div>
                <h3 class="text-lg font-medium text-purple-900 pt-2">
                  Location
                </h3>
                <p class="text-slate-500 mt-1">{frontmatter.location}</p>
              </div>

              <div>
                <h3 class="text-lg font-medium text-purple-900 pt-2">
                  Salary Range
                </h3>
                <p class="text-slate-500 mt-1">
                  {new Intl.NumberFormat('en-US', {
                    style: 'currency',
                    currency: frontmatter.baseSalary.currency,
                    maximumFractionDigits: 0
                  }).format(frontmatter.baseSalary.minValue)} - {new Intl.NumberFormat('en-US', {
                    style: 'currency',
                    currency: frontmatter.baseSalary.currency,
                    maximumFractionDigits: 0
                  }).format(frontmatter.baseSalary.maxValue)} / {frontmatter.baseSalary.unitText.toLowerCase()}
                </p>
              </div>

              <div>
                <h3 class="text-lg font-medium text-purple-900 pt-2">
                  Category
                </h3>
                <p class="text-slate-500 mt-1">{frontmatter.occupationalCategory}</p>
              </div>

              <div>
                <h3 class="text-lg font-medium text-purple-900 pt-2">
                  Team
                </h3>
                <p class="text-slate-500 mt-1">{frontmatter.team}</p>
              </div>

              <div class="pt-4 flex">
                <button
                  id="openModal"
                  class="text-white items-center font-medium gap-3 inline-flex focus-visible:outline-2 focus-visible:outline-offset-2 focus:outline-none justify-center px-6 lg:px-8 ring-2 ring-transparent focus:ring-offset-2 focus:ring-blue-500 duration-200 py-3.5 rounded-full active:bg-blue-800 active:text-white bg-blue-500 hover:bg-blue-600 w-full"
                >
                  Apply now
                </button>
              </div>
            </nav>
          </div>
        </div>
      </div>
      <div class="lg:w-1/2 lg:order-first">
        <div class="flex-shrink-0">
          <p
            class="text-purple-900 font-semibold mt-6 text-3xl tracking-tight lg:text-balance">
            {frontmatter.position}
          </p>
          <div class="prose-styles">
            <slot />
          </div>
        </div>
      </div>
    </div>
  </section>
  <section class="bg-white">
    <div class="lg:p-8">
      <div class="bg-purple-900 max-w-7xl mx-auto lg:rounded-3xl">
        <div class="mx-auto max-w-7xl lg:px-16 md:px-12 px-8 xl:px-24 py-24">
          <div>
            <h2
              class="text-white font-semibold tracking-tighter lg:text-5xl text-3xl">
              We look forward to hearing from you
            </h2>
            <p class="text-slate-300 mt-5 lg:text-balance">
              At Tustin Recruiting, we're looking for people with passion, grit, and
              integrity. You're encouraged to apply even if your experience
              doesn't precisely match the job description. Your skills and
              passion will stand out—and set you apart—especially if your career
              has taken some extraordinary twists and turns. At Tustin Recruiting,
              we welcome diverse perspectives and people who think rigorously
              and aren't afraid to challenge assumptions. Join us.
            </p>
            <div class="mt-10 flex">
              <a
                class="text-white items-center font-medium gap-3 inline-flex focus-visible:outline-2 focus-visible:outline-offset-2 focus:outline-none justify-center px-6 lg:px-8 ring-2 ring-transparent focus:ring-offset-2 focus:ring-blue-500 duration-200 py-3.5 rounded-full active:bg-blue-800 active:text-white bg-blue-500 hover:bg-blue-600 w-auto"
                href="/job-application">
                Apply now
              </a>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>
  <ApplicationModal 
    jobTitle={frontmatter.position}
    company={frontmatter.hiringOrganization.name}
    location={frontmatter.location}
    jobId={frontmatter.identifier.value}
    emails={frontmatter.email}
  />
</BaseLayout>

<script>
  // Add modal trigger
  const openButton = document.getElementById('openModal');
  const modal = document.getElementById('applicationModal') as HTMLDialogElement;

  openButton?.addEventListener('click', () => {
    modal.showModal();
  });
</script>
